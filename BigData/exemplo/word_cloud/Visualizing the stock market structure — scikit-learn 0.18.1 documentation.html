<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  
    <title>Visualizing the stock market structure — scikit-learn 0.18.1 documentation</title>
  <!-- htmltitle is before nature.css - we use this hack to load bootstrap first -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/bootstrap.css" media="screen">
  <link rel="stylesheet" href="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/bootstrap-responsive.css">

    
    <link rel="stylesheet" href="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/nature.css" type="text/css">
    <link rel="stylesheet" href="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/pygments.css" type="text/css">
    <link rel="stylesheet" href="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/gallery.css" type="text/css">
    <link rel="stylesheet" href="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/gallery.css" type="text/css">
    
    <script src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/async-ads.js" async=""></script><script src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/ga.js" async="" type="text/javascript"></script><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.18.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/jquery.js"></script>
    <script type="text/javascript" src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/underscore.js"></script>
    <script type="text/javascript" src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/doctools.js"></script>
    <script type="text/javascript" src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/copybutton.js"></script>
    <link rel="shortcut icon" href="http://scikit-learn.org/stable/_static/favicon.ico">
    <link rel="author" title="About these documents" href="http://scikit-learn.org/stable/about.html">
    <link rel="search" title="Search" href="http://scikit-learn.org/stable/search.html">
    <link rel="top" title="scikit-learn 0.18.1 documentation" href="http://scikit-learn.org/stable/index.html">
    <link rel="up" title="General examples" href="http://scikit-learn.org/stable/auto_examples/index.html">
    <link rel="next" title="Model Complexity Influence" href="http://scikit-learn.org/stable/auto_examples/applications/plot_model_complexity_influence.html">
    <link rel="prev" title="Faces recognition example using eigenfaces and SVMs" href="http://scikit-learn.org/stable/auto_examples/applications/face_recognition.html">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/bootstrap.js" type="text/javascript"></script>
  <link rel="canonical" href="http://scikit-learn.org/stable/auto_examples/applications/plot_stock_market.html">

  <script type="text/javascript">
    $("div.buttonNext, div.buttonPrevious").hover(
       function () {
           $(this).css('background-color', '#FF9C34');
       },
       function () {
           $(this).css('background-color', '#A7D6E2');
       }
    );
    function showMenu() {
      var topNav = document.getElementById("scikit-navbar");
      if (topNav.className === "navbar") {
          topNav.className += " responsive";
      } else {
          topNav.className = "navbar";
      }
    };
  </script>

  <style type="text/css">.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;position:relative;user-select:none;-moz-user-select:none;white-space:nowrap}.gsst_e{opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsq_a{padding:0}.gscsep_a{display:none}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gsfe_a{border:1px solid #b9b9b9;border-top-color:#a0a0a0;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);}.gsfe_b{border:1px solid #4d90fe;outline:none;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);}.gssb_a{padding:0 7px}.gssb_e{border:0}.gssb_l{margin:5px 0}#gsc-i-id1::-webkit-input-placeholder{font-size:14px}#gsc-i-id1:-moz-placeholder{font-size:14px}#gsc-i-id1::-moz-placeholder{font-size:14px}#gsc-i-id1:-ms-input-placeholder{font-size:14px}#gsc-i-id1:focus::-webkit-input-placeholder{color:transparent}#gsc-i-id1:focus:-moz-placeholder{color:transparent}#gsc-i-id1:focus::-moz-placeholder{color:transparent}#gsc-i-id1:focus:-ms-input-placeholder{color:transparent}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style></head>
  <body role="document">

<div class="header-wrapper">
    <div class="header">
        <p class="logo"><a href="http://scikit-learn.org/stable/index.html">
            <img src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/scikit-learn-logo-small.png" alt="Logo">
        </a>
        </p><div class="navbar" id="scikit-navbar">
            <ul>
                <li><a href="http://scikit-learn.org/stable/index.html">Home</a></li>
                <li><a href="http://scikit-learn.org/stable/install.html">Installation</a></li>
                <li class="btn-li"><div class="btn-group">
              <a href="http://scikit-learn.org/stable/documentation.html">Documentation</a>
              <a class="btn dropdown-toggle" data-toggle="dropdown">
                 <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
            <li class="link-title">Scikit-learn 0.18 (stable)</li>
            <li><a href="http://scikit-learn.org/stable/tutorial/index.html">Tutorials</a></li>
            <li><a href="http://scikit-learn.org/stable/user_guide.html">User guide</a></li>
            <li><a href="http://scikit-learn.org/stable/modules/classes.html">API</a></li>
            <li><a href="http://scikit-learn.org/stable/faq.html">FAQ</a></li>
            <li><a href="http://scikit-learn.org/stable/developers/contributing.html">Contributing</a></li>
            <li class="divider"></li>
                <li><a href="http://scikit-learn.org/dev/documentation.html">Scikit-learn 0.19-dev (development)</a></li>
                <li><a href="http://scikit-learn.org/0.17/documentation.html">Scikit-learn 0.17</a></li>
                <li><a href="http://scikit-learn.org/0.16/documentation.html">Scikit-learn 0.16</a></li>
                <li><a href="http://scikit-learn.org/0.15/documentation.html">Scikit-learn 0.15</a></li>
				<li><a href="http://scikit-learn.org/stable/_downloads/scikit-learn-docs.pdf">PDF documentation</a></li>
              </ul>
            </div>
        </li>
            <li><a href="http://scikit-learn.org/stable/auto_examples/index.html">Examples</a></li>
            </ul>
            <a href="javascript:void(0);" onclick="showMenu()">
                <div class="nav-icon">
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                </div>
            </a>
            <div class="search_form">
                <div id="cse" style="width: 100%;"><div class="gsc-control-cse gsc-control-cse-en"><div dir="ltr" class="gsc-control-wrapper-cse"><form accept-charset="utf-8" class="gsc-search-box"><table class="gsc-search-box" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-input"><input placeholder="Custom Search" style="outline: medium none; background: rgb(255, 255, 255) url(&quot;http://www.google.com/cse/static/images/1x/googlelogo_lightgrey_46x16dp.png&quot;) no-repeat scroll left center; text-indent: 48px;" spellcheck="false" dir="ltr" id="gsc-i-id1" title="search" name="search" class=" gsc-input " size="10" autocomplete="off" type="text"><input id="bgresponse" name="bgresponse" type="hidden"></td><td class="gsc-search-button"><input title="search" class="gsc-search-button" value="Search" type="button"></td><td class="gsc-clear-button"><div title="clear results" class="gsc-clear-button">&nbsp;</div></td></tr></tbody></table><table class="gsc-branding" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-branding-user-defined"></td><td class="gsc-branding-text"><div class="gsc-branding-text">powered by</div></td><td class="gsc-branding-img"><img srcset="https://www.google.com/cse/static/images/2x/googlelogo_grey_46x15dp.png 2x" class="gsc-branding-img" src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/googlelogo_grey_46x15dp.png"></td></tr></tbody></table></form><div class="gsc-results-wrapper-nooverlay"><div class="gsc-tabsAreaInvisible"><div class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Custom Search</div><span class="gs-spacer"> </span></div><div class="gsc-tabsAreaInvisible"></div><div class="gsc-above-wrapper-area-invisible"><table class="gsc-above-wrapper-area-container" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><table class="gsc-resultsHeader" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-twiddleRegionCell"><div class="gsc-twiddle"><div class="gsc-title">Web</div></div><div class="gsc-stats"></div><div class="gsc-results-selector gsc-all-results-active"><div title="show one result" class="gsc-result-selector gsc-one-result">&nbsp;</div><div title="show more results" class="gsc-result-selector gsc-more-results">&nbsp;</div><div title="show all results" class="gsc-result-selector gsc-all-results">&nbsp;</div></div></td><td class="gsc-configLabelCell"></td></tr></tbody></table><div><div class="gsc-expansionArea"></div></div></div></div></div></div></div></div></div>
            </div>
        </div> <!-- end navbar --></div>
</div>


<!-- Github "fork me" ribbon -->
<a href="https://github.com/scikit-learn/scikit-learn">
  <img class="fork-me" style="position: absolute; top: 0; right: 0; border: 0;" src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/forkme.png" alt="Fork me on GitHub">
</a>

<div class="content-wrapper">
    <div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
        <div class="rel">
    
        <div class="rellink">
        <a href="http://scikit-learn.org/stable/auto_examples/applications/face_recognition.html" accesskey="P">Previous
        <br>
        <span class="smallrellink">
        Faces recogni...
        </span>
            <span class="hiddenrellink">
            Faces recognition example using eigenfaces and SVMs
            </span>
        </a>
        </div>
            <div class="spacer">
            &nbsp;
            </div>
        <div class="rellink">
        <a href="http://scikit-learn.org/stable/auto_examples/applications/plot_model_complexity_influence.html" accesskey="N">Next
        <br>
        <span class="smallrellink">
        Model Complex...
        </span>
            <span class="hiddenrellink">
            Model Complexity Influence
            </span>
        </a>
        </div>

    <!-- Ad a link to the 'up' page -->
        <div class="spacer">
        &nbsp;
        </div>
        <div class="rellink">
        <a href="http://scikit-learn.org/stable/auto_examples/index.html">
        Up
        <br>
        <span class="smallrellink">
        General examples
        </span>
            <span class="hiddenrellink">
            General examples
            </span>
            
        </a>
        </div>
    </div>
    
      <p class="doc-version">This documentation is for scikit-learn <strong>version 0.18.1</strong> — <a href="http://scikit-learn.org/stable/support.html#documentation-resources">Other versions</a></p>
    <p class="citing">If you use the software, please consider <a href="http://scikit-learn.org/stable/about.html#citing-scikit-learn">citing scikit-learn</a>.</p>
    <ul>
<li><a class="reference internal" href="#">Visualizing the stock market structure</a><ul>
<li><a class="reference internal" href="#learning-a-graph-structure">Learning a graph structure</a></li>
<li><a class="reference internal" href="#clustering">Clustering</a></li>
<li><a class="reference internal" href="#embedding-in-2d-space">Embedding in 2D space</a></li>
<li><a class="reference internal" href="#visualization">Visualization</a></li>
</ul>
</li>
</ul>

    </div>
</div>

<input id="nav-trigger" class="nav-trigger" checked="checked" type="checkbox">
<label for="nav-trigger"></label>




      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="visualizing-the-stock-market-structure">
<span id="sphx-glr-auto-examples-applications-plot-stock-market-py"></span><h1>Visualizing the stock market structure<a class="headerlink" href="#visualizing-the-stock-market-structure" title="Permalink to this headline">¶</a></h1>
<p>This example employs several unsupervised learning techniques to extract
the stock market structure from variations in historical quotes.</p>
<p>The quantity that we use is the daily variation in quote price: quotes
that are linked tend to cofluctuate during a day.</p>
<div class="section" id="learning-a-graph-structure">
<span id="stock-market"></span><h2>Learning a graph structure<a class="headerlink" href="#learning-a-graph-structure" title="Permalink to this headline">¶</a></h2>
<p>We use sparse inverse covariance estimation to find which quotes are
correlated conditionally on the others. Specifically, sparse inverse
covariance gives us a graph, that is a list of connection. For each
symbol, the symbols that it is connected too are those useful to explain
its fluctuations.</p>
</div>
<div class="section" id="clustering">
<h2>Clustering<a class="headerlink" href="#clustering" title="Permalink to this headline">¶</a></h2>
<p>We use clustering to group together quotes that behave similarly. Here,
amongst the <a class="reference internal" href="http://scikit-learn.org/stable/modules/clustering.html#clustering"><span class="std std-ref">various clustering techniques</span></a> available
in the scikit-learn, we use <a class="reference internal" href="http://scikit-learn.org/stable/modules/clustering.html#affinity-propagation"><span class="std std-ref">Affinity Propagation</span></a> as it does
not enforce equal-size clusters, and it can choose automatically the
number of clusters from the data.</p>
<p>Note that this gives us a different indication than the graph, as the
graph reflects conditional relations between variables, while the
clustering reflects marginal properties: variables clustered together can
be considered as having a similar impact at the level of the full stock
market.</p>
</div>
<div class="section" id="embedding-in-2d-space">
<h2>Embedding in 2D space<a class="headerlink" href="#embedding-in-2d-space" title="Permalink to this headline">¶</a></h2>
<p>For visualization purposes, we need to lay out the different symbols on a
2D canvas. For this we use <a class="reference internal" href="http://scikit-learn.org/stable/modules/manifold.html#manifold"><span class="std std-ref">Manifold learning</span></a> techniques to retrieve 2D
embedding.</p>
</div>
<div class="section" id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<p>The output of the 3 models are combined in a 2D graph where nodes
represents the stocks and edges the:</p>
<ul class="simple">
<li>cluster labels are used to define the color of the nodes</li>
<li>the sparse covariance model is used to display the strength of the edges</li>
<li>the 2D embedding is used to position the nodes in the plan</li>
</ul>
<p>This example has a fair amount of visualization-related code, as
visualization is crucial here to display the graph. One of the challenge
is to position the labels minimizing overlap. For this we use an
heuristic based on the direction of the nearest neighbor along each
axis.</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>

<span class="c1"># Author: Gael Varoquaux gael.varoquaux@normalesup.org</span>
<span class="c1"># License: BSD 3 clause</span>

<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="k">try</span><span class="p">:</span>
     <span class="kn">from</span> <span class="nn">matplotlib.finance</span> <span class="kn">import</span> <span class="n">quotes_historical_yahoo_ochl</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
     <span class="c1"># quotes_historical_yahoo_ochl was named quotes_historical_yahoo before matplotlib 1.4</span>
     <span class="kn">from</span> <span class="nn">matplotlib.finance</span> <span class="kn">import</span> <span class="n">quotes_historical_yahoo</span> <span class="k">as</span> <span class="n">quotes_historical_yahoo_ochl</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <a href="http://matplotlib.org/api/collections_api.html#matplotlib.collections.LineCollection"><span class="n">LineCollection</span></a>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">covariance</span><span class="p">,</span> <span class="n">manifold</span>
</pre></div>
</div>
<p>Retrieve the data from Internet</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Choose a time period reasonably calm (not too long ago so that we get</span>
<span class="c1"># high-tech firms, and before the 2008 crash)</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># kraft symbol has now changed from KFT to MDLZ in yahoo</span>
<span class="n">symbol_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'TOT'</span><span class="p">:</span> <span class="s1">'Total'</span><span class="p">,</span>
    <span class="s1">'XOM'</span><span class="p">:</span> <span class="s1">'Exxon'</span><span class="p">,</span>
    <span class="s1">'CVX'</span><span class="p">:</span> <span class="s1">'Chevron'</span><span class="p">,</span>
    <span class="s1">'COP'</span><span class="p">:</span> <span class="s1">'ConocoPhillips'</span><span class="p">,</span>
    <span class="s1">'VLO'</span><span class="p">:</span> <span class="s1">'Valero Energy'</span><span class="p">,</span>
    <span class="s1">'MSFT'</span><span class="p">:</span> <span class="s1">'Microsoft'</span><span class="p">,</span>
    <span class="s1">'IBM'</span><span class="p">:</span> <span class="s1">'IBM'</span><span class="p">,</span>
    <span class="s1">'TWX'</span><span class="p">:</span> <span class="s1">'Time Warner'</span><span class="p">,</span>
    <span class="s1">'CMCSA'</span><span class="p">:</span> <span class="s1">'Comcast'</span><span class="p">,</span>
    <span class="s1">'CVC'</span><span class="p">:</span> <span class="s1">'Cablevision'</span><span class="p">,</span>
    <span class="s1">'YHOO'</span><span class="p">:</span> <span class="s1">'Yahoo'</span><span class="p">,</span>
    <span class="s1">'DELL'</span><span class="p">:</span> <span class="s1">'Dell'</span><span class="p">,</span>
    <span class="s1">'HPQ'</span><span class="p">:</span> <span class="s1">'HP'</span><span class="p">,</span>
    <span class="s1">'AMZN'</span><span class="p">:</span> <span class="s1">'Amazon'</span><span class="p">,</span>
    <span class="s1">'TM'</span><span class="p">:</span> <span class="s1">'Toyota'</span><span class="p">,</span>
    <span class="s1">'CAJ'</span><span class="p">:</span> <span class="s1">'Canon'</span><span class="p">,</span>
    <span class="s1">'MTU'</span><span class="p">:</span> <span class="s1">'Mitsubishi'</span><span class="p">,</span>
    <span class="s1">'SNE'</span><span class="p">:</span> <span class="s1">'Sony'</span><span class="p">,</span>
    <span class="s1">'F'</span><span class="p">:</span> <span class="s1">'Ford'</span><span class="p">,</span>
    <span class="s1">'HMC'</span><span class="p">:</span> <span class="s1">'Honda'</span><span class="p">,</span>
    <span class="s1">'NAV'</span><span class="p">:</span> <span class="s1">'Navistar'</span><span class="p">,</span>
    <span class="s1">'NOC'</span><span class="p">:</span> <span class="s1">'Northrop Grumman'</span><span class="p">,</span>
    <span class="s1">'BA'</span><span class="p">:</span> <span class="s1">'Boeing'</span><span class="p">,</span>
    <span class="s1">'KO'</span><span class="p">:</span> <span class="s1">'Coca Cola'</span><span class="p">,</span>
    <span class="s1">'MMM'</span><span class="p">:</span> <span class="s1">'3M'</span><span class="p">,</span>
    <span class="s1">'MCD'</span><span class="p">:</span> <span class="s1">'Mc Donalds'</span><span class="p">,</span>
    <span class="s1">'PEP'</span><span class="p">:</span> <span class="s1">'Pepsi'</span><span class="p">,</span>
    <span class="s1">'MDLZ'</span><span class="p">:</span> <span class="s1">'Kraft Foods'</span><span class="p">,</span>
    <span class="s1">'K'</span><span class="p">:</span> <span class="s1">'Kellogg'</span><span class="p">,</span>
    <span class="s1">'UN'</span><span class="p">:</span> <span class="s1">'Unilever'</span><span class="p">,</span>
    <span class="s1">'MAR'</span><span class="p">:</span> <span class="s1">'Marriott'</span><span class="p">,</span>
    <span class="s1">'PG'</span><span class="p">:</span> <span class="s1">'Procter Gamble'</span><span class="p">,</span>
    <span class="s1">'CL'</span><span class="p">:</span> <span class="s1">'Colgate-Palmolive'</span><span class="p">,</span>
    <span class="s1">'GE'</span><span class="p">:</span> <span class="s1">'General Electrics'</span><span class="p">,</span>
    <span class="s1">'WFC'</span><span class="p">:</span> <span class="s1">'Wells Fargo'</span><span class="p">,</span>
    <span class="s1">'JPM'</span><span class="p">:</span> <span class="s1">'JPMorgan Chase'</span><span class="p">,</span>
    <span class="s1">'AIG'</span><span class="p">:</span> <span class="s1">'AIG'</span><span class="p">,</span>
    <span class="s1">'AXP'</span><span class="p">:</span> <span class="s1">'American express'</span><span class="p">,</span>
    <span class="s1">'BAC'</span><span class="p">:</span> <span class="s1">'Bank of America'</span><span class="p">,</span>
    <span class="s1">'GS'</span><span class="p">:</span> <span class="s1">'Goldman Sachs'</span><span class="p">,</span>
    <span class="s1">'AAPL'</span><span class="p">:</span> <span class="s1">'Apple'</span><span class="p">,</span>
    <span class="s1">'SAP'</span><span class="p">:</span> <span class="s1">'SAP'</span><span class="p">,</span>
    <span class="s1">'CSCO'</span><span class="p">:</span> <span class="s1">'Cisco'</span><span class="p">,</span>
    <span class="s1">'TXN'</span><span class="p">:</span> <span class="s1">'Texas instruments'</span><span class="p">,</span>
    <span class="s1">'XRX'</span><span class="p">:</span> <span class="s1">'Xerox'</span><span class="p">,</span>
    <span class="s1">'LMT'</span><span class="p">:</span> <span class="s1">'Lookheed Martin'</span><span class="p">,</span>
    <span class="s1">'WMT'</span><span class="p">:</span> <span class="s1">'Wal-Mart'</span><span class="p">,</span>
    <span class="s1">'WBA'</span><span class="p">:</span> <span class="s1">'Walgreen'</span><span class="p">,</span>
    <span class="s1">'HD'</span><span class="p">:</span> <span class="s1">'Home Depot'</span><span class="p">,</span>
    <span class="s1">'GSK'</span><span class="p">:</span> <span class="s1">'GlaxoSmithKline'</span><span class="p">,</span>
    <span class="s1">'PFE'</span><span class="p">:</span> <span class="s1">'Pfizer'</span><span class="p">,</span>
    <span class="s1">'SNY'</span><span class="p">:</span> <span class="s1">'Sanofi-Aventis'</span><span class="p">,</span>
    <span class="s1">'NVS'</span><span class="p">:</span> <span class="s1">'Novartis'</span><span class="p">,</span>
    <span class="s1">'KMB'</span><span class="p">:</span> <span class="s1">'Kimberly-Clark'</span><span class="p">,</span>
    <span class="s1">'R'</span><span class="p">:</span> <span class="s1">'Ryder'</span><span class="p">,</span>
    <span class="s1">'GD'</span><span class="p">:</span> <span class="s1">'General Dynamics'</span><span class="p">,</span>
    <span class="s1">'RTN'</span><span class="p">:</span> <span class="s1">'Raytheon'</span><span class="p">,</span>
    <span class="s1">'CVS'</span><span class="p">:</span> <span class="s1">'CVS'</span><span class="p">,</span>
    <span class="s1">'CAT'</span><span class="p">:</span> <span class="s1">'Caterpillar'</span><span class="p">,</span>
    <span class="s1">'DD'</span><span class="p">:</span> <span class="s1">'DuPont de Nemours'</span><span class="p">}</span>

<span class="n">symbols</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbol_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span>

<span class="n">quotes</span> <span class="o">=</span> <span class="p">[</span><span class="n">quotes_historical_yahoo_ochl</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">asobject</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]</span>

<span class="nb">open</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">q</span><span class="o">.</span><span class="n">open</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quotes</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">close</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">q</span><span class="o">.</span><span class="n">close</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quotes</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="c1"># The daily variations of the quotes are what carry most information</span>
<span class="n">variation</span> <span class="o">=</span> <span class="n">close</span> <span class="o">-</span> <span class="nb">open</span>
</pre></div>
</div>
<p>Learn a graphical structure from the correlations</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><pre><span></span><span class="n">edge_model</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.covariance.GraphLassoCV.html#sklearn.covariance.GraphLassoCV"><span class="n">covariance</span><span class="o">.</span><span class="n">GraphLassoCV</span></a><span class="p">()</span>

<span class="c1"># standardize the time series: using correlations rather than covariance</span>
<span class="c1"># is more efficient for structure recovery</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">variation</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="n">X</span> <span class="o">/=</span> <span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">edge_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p>Cluster using affinity propagation</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cluster.affinity_propagation.html#sklearn.cluster.affinity_propagation"><span class="n">cluster</span><span class="o">.</span><span class="n">affinity_propagation</span></a><span class="p">(</span><span class="n">edge_model</span><span class="o">.</span><span class="n">covariance_</span><span class="p">)</span>
<span class="n">n_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'Cluster </span><span class="si">%i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">])))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div style="position: relative;" class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span>  <span class="n">Cluster</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Pepsi</span><span class="p">,</span> <span class="n">Coca</span> <span class="n">Cola</span><span class="p">,</span> <span class="n">Kellogg</span>
<span class="n">Cluster</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Apple</span><span class="p">,</span> <span class="n">Amazon</span><span class="p">,</span> <span class="n">Yahoo</span>
<span class="n">Cluster</span> <span class="mi">3</span><span class="p">:</span> <span class="n">GlaxoSmithKline</span><span class="p">,</span> <span class="n">Novartis</span><span class="p">,</span> <span class="n">Sanofi</span><span class="o">-</span><span class="n">Aventis</span>
<span class="n">Cluster</span> <span class="mi">4</span><span class="p">:</span> <span class="n">Comcast</span><span class="p">,</span> <span class="n">Time</span> <span class="n">Warner</span><span class="p">,</span> <span class="n">Cablevision</span>
<span class="n">Cluster</span> <span class="mi">5</span><span class="p">:</span> <span class="n">ConocoPhillips</span><span class="p">,</span> <span class="n">Chevron</span><span class="p">,</span> <span class="n">Total</span><span class="p">,</span> <span class="n">Valero</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">Exxon</span>
<span class="n">Cluster</span> <span class="mi">6</span><span class="p">:</span> <span class="n">CVS</span><span class="p">,</span> <span class="n">Walgreen</span>
<span class="n">Cluster</span> <span class="mi">7</span><span class="p">:</span> <span class="n">Navistar</span><span class="p">,</span> <span class="n">Sony</span><span class="p">,</span> <span class="n">Marriott</span><span class="p">,</span> <span class="n">Caterpillar</span><span class="p">,</span> <span class="n">Canon</span><span class="p">,</span> <span class="n">Toyota</span><span class="p">,</span> <span class="n">Honda</span><span class="p">,</span> <span class="n">Mitsubishi</span><span class="p">,</span> <span class="n">Xerox</span><span class="p">,</span> <span class="n">Unilever</span>
<span class="n">Cluster</span> <span class="mi">8</span><span class="p">:</span> <span class="n">Kimberly</span><span class="o">-</span><span class="n">Clark</span><span class="p">,</span> <span class="n">Colgate</span><span class="o">-</span><span class="n">Palmolive</span><span class="p">,</span> <span class="n">Procter</span> <span class="n">Gamble</span>
<span class="n">Cluster</span> <span class="mi">9</span><span class="p">:</span> <span class="n">American</span> <span class="n">express</span><span class="p">,</span> <span class="n">Ryder</span><span class="p">,</span> <span class="n">Goldman</span> <span class="n">Sachs</span><span class="p">,</span> <span class="n">Wal</span><span class="o">-</span><span class="n">Mart</span><span class="p">,</span> <span class="n">General</span> <span class="n">Electrics</span><span class="p">,</span> <span class="n">Pfizer</span><span class="p">,</span> <span class="n">Wells</span> <span class="n">Fargo</span><span class="p">,</span> <span class="n">DuPont</span> <span class="n">de</span> <span class="n">Nemours</span><span class="p">,</span> <span class="n">Bank</span> <span class="n">of</span> <span class="n">America</span><span class="p">,</span> <span class="n">AIG</span><span class="p">,</span> <span class="n">Home</span> <span class="n">Depot</span><span class="p">,</span> <span class="n">Ford</span><span class="p">,</span> <span class="n">JPMorgan</span> <span class="n">Chase</span><span class="p">,</span> <span class="n">Mc</span> <span class="n">Donalds</span>
<span class="n">Cluster</span> <span class="mi">10</span><span class="p">:</span> <span class="n">Microsoft</span><span class="p">,</span> <span class="n">SAP</span><span class="p">,</span> <span class="mi">3</span><span class="n">M</span><span class="p">,</span> <span class="n">IBM</span><span class="p">,</span> <span class="n">Texas</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">HP</span><span class="p">,</span> <span class="n">Dell</span><span class="p">,</span> <span class="n">Cisco</span>
<span class="n">Cluster</span> <span class="mi">11</span><span class="p">:</span> <span class="n">Raytheon</span><span class="p">,</span> <span class="n">Boeing</span><span class="p">,</span> <span class="n">Lookheed</span> <span class="n">Martin</span><span class="p">,</span> <span class="n">General</span> <span class="n">Dynamics</span><span class="p">,</span> <span class="n">Northrop</span> <span class="n">Grumman</span>
<span class="n">Cluster</span> <span class="mi">12</span><span class="p">:</span> <span class="n">Kraft</span> <span class="n">Foods</span>
</pre></div>
</div>
<p>Find a low-dimension embedding for visualization: find the best position of
the nodes (the stocks) on a 2D plane</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># We use a dense eigen_solver to achieve reproducibility (arpack is</span>
<span class="c1"># initiated with random vectors that we don't control). In addition, we</span>
<span class="c1"># use a large number of neighbors to capture the large-scale structure.</span>
<span class="n">node_position_model</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.manifold.LocallyLinearEmbedding.html#sklearn.manifold.LocallyLinearEmbedding"><span class="n">manifold</span><span class="o">.</span><span class="n">LocallyLinearEmbedding</span></a><span class="p">(</span>
    <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">eigen_solver</span><span class="o">=</span><span class="s1">'dense'</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">embedding</span> <span class="o">=</span> <span class="n">node_position_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>Visualization</p>
<div style="position: relative;" class="highlight-python"><div class="highlight"><pre><span></span><a href="http://matplotlib.org/api/figure_api.html#matplotlib.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.clf"><span class="n">plt</span><span class="o">.</span><span class="n">clf</span></a><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <a href="http://matplotlib.org/api/axes_api.html#matplotlib.axes"><span class="n">plt</span><span class="o">.</span><span class="n">axes</span></a><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
<a href="http://matplotlib.org/api/axis_api.html#matplotlib.axis"><span class="n">plt</span><span class="o">.</span><span class="n">axis</span></a><span class="p">(</span><span class="s1">'off'</span><span class="p">)</span>

<span class="c1"># Display a graph of the partial correlations</span>
<span class="n">partial_correlations</span> <span class="o">=</span> <span class="n">edge_model</span><span class="o">.</span><span class="n">precision_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.sqrt.html#numpy.sqrt"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.diag.html#numpy.diag"><span class="n">np</span><span class="o">.</span><span class="n">diag</span></a><span class="p">(</span><span class="n">partial_correlations</span><span class="p">))</span>
<span class="n">partial_correlations</span> <span class="o">*=</span> <span class="n">d</span>
<span class="n">partial_correlations</span> <span class="o">*=</span> <span class="n">d</span><span class="p">[:,</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/arrays.indexing.html#numpy.newaxis"><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span></a><span class="p">]</span>
<span class="n">non_zero</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.triu.html#numpy.triu"><span class="n">np</span><span class="o">.</span><span class="n">triu</span></a><span class="p">(</span><span class="n">partial_correlations</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.02</span><span class="p">)</span>

<span class="c1"># Plot the nodes using the coordinates of our embedding</span>
<a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.scatter"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span></a><span class="p">(</span><span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">embedding</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">d</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">spectral</span><span class="p">)</span>

<span class="c1"># Plot the edges</span>
<span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.where.html#numpy.where"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">non_zero</span><span class="p">)</span>
<span class="c1">#a sequence of (*line0*, *line1*, *line2*), where::</span>
<span class="c1">#            linen = (x0, y0), (x1, y1), ... (xm, ym)</span>
<span class="n">segments</span> <span class="o">=</span> <span class="p">[[</span><span class="n">embedding</span><span class="p">[:,</span> <span class="n">start</span><span class="p">],</span> <span class="n">embedding</span><span class="p">[:,</span> <span class="n">stop</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)]</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">partial_correlations</span><span class="p">[</span><span class="n">non_zero</span><span class="p">])</span>
<span class="n">lc</span> <span class="o">=</span> <a href="http://matplotlib.org/api/collections_api.html#matplotlib.collections.LineCollection"><span class="n">LineCollection</span></a><span class="p">(</span><span class="n">segments</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span> <span class="o">*</span> <span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<span class="n">lc</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="n">lc</span><span class="o">.</span><span class="n">set_linewidths</span><span class="p">(</span><span class="mi">15</span> <span class="o">*</span> <span class="n">values</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>

<span class="c1"># Add a label to each node. The challenge here is that we want to</span>
<span class="c1"># position the labels to avoid overlap with other labels</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">embedding</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dx</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">embedding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dy</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">this_dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">[</span><a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.argmin.html#numpy.argmin"><span class="n">np</span><span class="o">.</span><span class="n">argmin</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">))]</span>
    <span class="n">this_dy</span> <span class="o">=</span> <span class="n">dy</span><span class="p">[</span><a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.argmin.html#numpy.argmin"><span class="n">np</span><span class="o">.</span><span class="n">argmin</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">this_dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="s1">'left'</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="o">.</span><span class="mo">002</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="s1">'right'</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="o">.</span><span class="mo">002</span>
    <span class="k">if</span> <span class="n">this_dy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">verticalalignment</span> <span class="o">=</span> <span class="s1">'bottom'</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="o">.</span><span class="mo">002</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">verticalalignment</span> <span class="o">=</span> <span class="s1">'top'</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="o">.</span><span class="mo">002</span>
    <a href="http://matplotlib.org/api/text_api.html#matplotlib.text"><span class="n">plt</span><span class="o">.</span><span class="n">text</span></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
             <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">horizontalalignment</span><span class="p">,</span>
             <span class="n">verticalalignment</span><span class="o">=</span><span class="n">verticalalignment</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span>
                       <span class="n">edgecolor</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">label</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_labels</span><span class="p">)),</span>
                       <span class="n">alpha</span><span class="o">=.</span><span class="mi">6</span><span class="p">))</span>

<a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.xlim"><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span></a><span class="p">(</span><span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="o">.</span><span class="mi">15</span> <span class="o">*</span> <span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ptp</span><span class="p">(),</span>
         <span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="o">.</span><span class="mi">10</span> <span class="o">*</span> <span class="n">embedding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ptp</span><span class="p">(),)</span>
<a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.ylim"><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span></a><span class="p">(</span><span class="n">embedding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="o">.</span><span class="mo">03</span> <span class="o">*</span> <span class="n">embedding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ptp</span><span class="p">(),</span>
         <span class="n">embedding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="o">.</span><span class="mo">03</span> <span class="o">*</span> <span class="n">embedding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ptp</span><span class="p">())</span>

<a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_stock_market_001.png" class="align-center" src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/sphx_glr_plot_stock_market_001.png">
<p><strong>Total running time of the script:</strong>
(0 minutes 11.405 seconds)</p>
<div class="sphx-glr-download container">
<strong>Download Python source code:</strong> <a class="reference download internal" href="http://scikit-learn.org/stable/_downloads/plot_stock_market.py" download=""><code class="xref download docutils literal"><span class="pre">plot_stock_market.py</span></code></a></div>
<div class="sphx-glr-download container">
<strong>Download IPython notebook:</strong> <a class="reference download internal" href="http://scikit-learn.org/stable/_downloads/plot_stock_market.ipynb" download=""><code class="xref download docutils literal"><span class="pre">plot_stock_market.ipynb</span></code></a></div>
</div>
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer">
        © 2010 - 2016, scikit-learn developers (BSD License).
      <a href="http://scikit-learn.org/stable/_sources/auto_examples/applications/plot_stock_market.txt" rel="nofollow">Show this page source</a>
    </div>
     <div class="rel">
    
    <div class="buttonPrevious">
      <a href="http://scikit-learn.org/stable/auto_examples/applications/face_recognition.html">Previous
      </a>
    </div>
    <div class="buttonNext">
      <a href="http://scikit-learn.org/stable/auto_examples/applications/plot_model_complexity_influence.html">Next
      </a>
    </div>
    
     </div>

    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22606712-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    

    <script src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/jsapi" type="text/javascript"></script>
    <script type="text/javascript"> google.load('search', '1',
        {language : 'en'}); google.setOnLoadCallback(function() {
            var customSearchControl = new
            google.search.CustomSearchControl('016639176250731907682:tjtqbvtvij0');
            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.setAutoComplete(true);
            customSearchControl.draw('cse', options); }, true);
    </script><script src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/a" type="text/javascript"></script><link href="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/defaulten.css" type="text/css" rel="stylesheet"><script src="Visualizing%20the%20stock%20market%20structure%20%E2%80%94%20scikit-learn%200.18.1%20documentation_arquivos/defaulten.js" type="text/javascript"></script>
  
<table class="gstl_50 gssb_c" style="width: 192px; display: none; top: 38px; left: 397px; position: absolute;" cellpadding="0" cellspacing="0"><tbody><tr><td class="gssb_f"></td><td style="width: 100%;" class="gssb_e"></td></tr></tbody></table></body></html>